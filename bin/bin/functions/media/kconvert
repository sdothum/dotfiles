#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Media
# ══════════════════════════════════════════════════════════════════════════════

# ................................................................ ebook convert

# Usage: [dropcap=<class>] kconvert [<format>|css=<css>]* <epub>*

SEP='⁋'

# SEE: econvert
while : ;do
	case "$1" in
		css=*    ) css="\"$1\""    ;; # BECAUSE: protect spaces within $<var> (css statement)
		default  ) option=default  ;;
		justify  ) option=justify  ;;
		noformat ) option=noformat ;;
		poetry   ) option=noformat ;; # retain poetry formatting
		all      ) option=all      ;;
		*        ) break           ;;
	esac
	shift
done

# SAVEIFS=$IFS
IFS=$(printf "${SEP}")  # NOTE: change separator from space to "\n" to handle book titles
[ "$1" ] && set -- $(echo $@ | sed -r "s/\.(epub|azw3|mobi) */.\1${SEP}/g") || set -- $(echo *.epub | sed "s/\.epub */.epub${SEP}/g")
while [ $# -gt 0 ] ;do
	if [ "$1" ] ;then  # (??) above IFS "set --" injects empty $vars
		eval menu econvert azw3 $css $option \"$1\"  # kindle
		eval menu econvert epub $css $option \"$1\"  # koreader
	fi
	shift
done
# IFS=$SAVEIFS

# kak: filetype=sh
