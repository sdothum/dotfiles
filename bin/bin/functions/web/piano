#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Web
# ══════════════════════════════════════════════════════════════════════════════

# ................................................................. piano stream

# Usage: piano [toggle | stop | stream]
# SEE:   rulerrc for window management

BROWSER=qutebrowser-instance
PIANO=https://p-node.org/piano/
NANO='∏ano - qutebrowser'
DELAY=0.65

case $1 in
	''     )
		mpc pause  # any playlist
		name=piano ${BROWSER:-qutebrowser} $PIANO

		sleep $DELAY  # tuned delays required to work around system dependent qutebrowser url loading
		xdotool search -sync -onlyvisible -name "$NANO" windowfocus
		window "@$NANO" size 600x300
		xdotool search -sync -onlyvisible -name "$NANO" windowfocus
		window "@$NANO" snap top left

		# complete zoom command and execute play button :)
		sleep $DELAY
		xdotool search -sync -onlyvisible -name "$NANO" windowfocus
		xdotool type ':zoom 50'
		xdotool key Return Tab Return

		pidwait -f ".*${PIANO}.*"
		mpc play
		;;
	toggle ) xdotool search --onlyvisible --name "$NANO" windowunmap || xdotool search --name "$NANO" windowmap ;;
	stop   ) xdotool search --name "$NANO" windowkill ;;
	stream ) xdotool search -name "$NANO" getwindowname | sed "s/ | $NANO//" ;;
esac

# kak: filetype=sh
