#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl
# Shell
# ══════════════════════════════════════════════════════════════════════════════

# ................................................................. yazi wrapper

# Usage: yazi [TMUX | ROOT] | [path]

export YAZI="/usr/bin/yazi"   # NOTE: envar is also used in alacrityt/kak wrappers for conditional tweaks
export EDITOR=kak
THEME=$HOME/.config/yazi/theme.toml
TAB=/net/downloads/http     # default tmux directory

# sloppy mtp automount
mtp mount && { [ "$1" ] || MTP=$HOME/mtp; }
[ "$1" != TMUX ] && trap 'mtp umount' EXIT  # must manually eject if mounted during toggle tmux session, see herbstluftwm appbinds
# udev                                        # reload udev rules

[ -e $SESSION/yazi ] && TERMBG=$(cat $SESSION/yazi)
case $TERMBG in
	''     ) cp $THEME:custom $THEME ;;
	dark   ) cp $THEME:flavor $THEME ;;
	light  ) cp $THEME:flavor $THEME; export TERMBG=PAPER ;;  # see term
	*      ) cp $THEME:custom $THEME ;;
esac

export TMUXCONF=$HOME/.tmux.conf.nnn  # SEE: tmux_session
# BECAUSE: tmux Home End keys echo H L in nnn input..
grep -Ev '^bind-key.*(Home|End)' $HOME/.tmux.conf >$TMUXCONF

case $1 in
	ROOT ) tmux_session 'root' sudo -E $YAZI $TAB ;;
	TMUX ) tmux_session 'yazi'         $YAZI $TAB ;;
	''   ) $YAZI .            ;;
	*    ) $YAZI "${MTP:-$@}" ;;
esac

# kak: filetype=sh
