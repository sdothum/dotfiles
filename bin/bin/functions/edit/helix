#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Edit
# ══════════════════════════════════════════════════════════════════════════════

# ....................................................................... Editor

# Usage: [name=<title>] helix [WAIT] <file>*

CONF=$XDG_CONFIG_HOME/helix
CONFIG=$CONF/config.toml
LANGUAGES=$CONF/languages.toml
TABSTOP=3  # default for (pipe) align

[ "$1" = WAIT ] && { WAIT=$1; shift; }  # foreground process?
[ -e "$1" ] || { notify critical 'Helix' "$1\nnot found"; exit 1; }

# snapshot sources (in lieu of persistent undo avalability)
hgadd $@ &  # don' wait :)

# update this file manually in lieu of ltex dictionary update
if [ -e $LANGUAGES:spelling ] ;then
	spelling="$(sort -df $LANGUAGES:spelling | sed -r 's/^ *(.*) *$/\\"\1\\":/' | tr '\n' ':')"  # comma's cause unterminated address regex error
	sed "/ltex.dictionary/a${spelling%::}" $LANGUAGES:template | sed "/ltex.dictionary/{n;s/::/,\n/g}" >$LANGUAGES
fi

[ $# -eq 1 ] && { cd $(dirname $1); file=$(basename $1); shift; set -- $file; }  # enable :open in file directory
term ${name:-helix} PAPER $WAIT ${HX:-hx} -c $CONFIG $@                          # term call doesn't handle "space" names

# vim: set ft=sh: #
