#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Dev
# ══════════════════════════════════════════════════════════════════════════════

# ........................................................ Directory differences

usage() { usage: "$(basename $0) [-r] [<source>] <target>"; exit 1; }

[ $1 = '-r' ] && { recurse=true; shift; }
[ $# -eq 2 ]  && { SOURCE=$1; shift; } || SOURCE=.
[ "$1" ] || usage

DIRS=/tmp/lsdiff:directory
[ $recurse ] && find $SOURCE -type d | exclude  >$DIRS || echo $SOURCE >$DIRS

while read source <&3 ;do
	clear
	target=$1/$source
	ls -1 $source | sort >/tmp/lsdiff:source
	ls -1 $target | sort >/tmp/lsdiff:target
	ditto source "< $source"
	ditto target "> $target"
	diff --color /tmp/lsdiff:source /tmp/lsdiff:target | pager
	[ $recurse ] && ifyes 'next directory' || break
done 3< $DIRS

# kak: filetype=sh
