#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl
# [ $TRACE ] && CHILD="desktop $@" . $PARENT

# Windowchef
# ══════════════════════════════════════════════════════════════════════════════

# ............................................................. Query operations

# Usage: desktop <msg> [specific | toggle]

[ -e $WME:desktop ] && desktop=$(cat $WME:desktop)
desktop=${desktop:-0}

current() {
	if [ -e $WME:desktop ] ;then
		if [ -e $WME:desktop:last ] ;then
			[ $WME:desktop -ne $(cat $WME:desktop:last) ] && mv -f $WME:desktop $WME:desktop:last
		fi
	else
		echo $desktop >$WME:desktop:last
	fi
	echo $1 >$WME:desktop
	notify Group "$(( $1 + 1 )) $(query desktop)"
}

desktop() {
	case $2 in
		specific )
			[ $desktop -eq $1 ] || current $1
			waitron group_activate_specific $1
			;;
		toggle   )
			[ $desktop -eq $1 ] || current $1
			waitron group_toggle $1
			;;
		*        )
			[ $desktop -eq $1 ] && { waitron group_toggle $1; return; }
			current $1
			waitron group_activate $1
			;;
	esac

}

plus() {
	desktop=$(( $desktop + $1 ))
	if [ $desktop -gt 5 ] ;then
		desktop=0
	elif [ $desktop -lt 0 ] ;then
		desktop=5
	fi
	echo $desktop
}

case $1 in
	''    ) echo $desktop ;;
	[0-5] ) desktop $1 $2 ;;
	last  ) [ -e $WME:desktop:last ] && desktop $(cat $WME:desktop:last) ;;
	*     ) desktop $(plus $1) ;;	 # -1/+1
esac

# kak: filetype=sh
