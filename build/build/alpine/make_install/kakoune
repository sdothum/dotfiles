#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Make_install
# ══════════════════════════════════════════════════════════════════════════════

# ............................................................... Kakoune editor

AUTOLOAD=$XDG_CONFIG_HOME/kak/autoload/plugs
mkdir -p $AUTOLOAD
KAKLSP=$XDG_CONFIG_HOME/kak-lsp
mkdir -p $KAKLSP

# doas apk add kakoune
cd /net/depot
[ -d kakoune ] && { cd kakoune; git pull; cd ..; } || git clone --depth 1 https://github.com/mawww/kakoune.git
cd kakoune
make
make man
doas make install

# plugins
# https://github.com/occivink/kakoune-buffer-switcher.git
plugins="
https://github.com/tinted-theming/base16-kakoune.git
"

for i in $plugins ;do
	cd /net/depot
	repo=${i##*/}
	repo=${repo%.git}
	[ -d $repo ] && { cd $repo; git pull; cd ..; } || git clone --depth 1 $i
	cd $repo
	if echo "$repo" | grep -q 'base16' ;then
		cp -v colors/base16-icy.kak ${AUTOLOAD%/autoload}/colors
	else
		find . -regex '.*\.(kak|lua)' -exec cp -v {} $AUTOLOAD \;
	fi
done

# tree-sitter
cargo install kak-tree-sitter
cargo install ktsctl

# kak-lsp
cd /net/depot
git clone https://github.com/kak-lsp/kak-lsp

cd kak-lsp
cargo install --locked --force --path .

ditto kak-lsp "check kak-lsp.toml configuration files"
cp kak-lsp.toml $KAKLSP/kak-lsp.toml.original
ditto kak-lsp "see make_install lsp"

# kak: filetype=sh
