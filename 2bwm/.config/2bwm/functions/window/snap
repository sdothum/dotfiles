#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl
[ $TRACE ] && CHILD="window/snap $@" . $PARENT

# 2bwm
# ══════════════════════════════════════════════════════════════════════════════

# ................................................................. Snap windows

# Usage: window snap [left | center | right | top | bottom | all (windows on desktop)]

eval $(xdotool getwindowgeometry --shell $winid)         # HEIGHT WIDTH (doesn't include borders)
save_geometry

# .................................................................... Snap left

snapleft() {
	# xdotool windowmove --sync $winid $(( $margin + $border - 1 )) $(( ($height - $HEIGHT) / 2 - $border ))
	xdotool windowmove --sync $winid $(( $margin + $border - 1 )) y
	xdotool windowactivate --sync $winid
}

# ................................................................... Snap right

snapright() {
	# xdotool windowmove --sync $winid $(( $width - $WIDTH - $border * 2 - $margin )) $(( ($height - $HEIGHT) / 2 - $border ))
	# xdotool windowmove --sync $winid $(( $width - $WIDTH - $border * 2 - $margin )) y
	xdotool windowmove --sync $winid $(( $width - $WIDTH + $border )) y
	xdotool windowactivate --sync $winid
}

# .................................................................... Snap edge

snapnear() {
	# snap to closest edge!
	[ $X -le $(right) ] && snapleft || snapright
	xdotool windowactivate --sync $winid
}

# ..................................................................... Snap top

snaptop() {
	xdotool windowmove --sync $winid x $margin
	xdotool windowactivate --sync $winid
}

# .................................................................. Snap bottom

snapbottom() {
	# xdotool windowmove --sync $winid x $(( $height - $HEIGHT - $margin - $border * 2 ))
	xdotool windowmove --sync $winid x $(( $height - $HEIGHT ))
	xdotool windowactivate --sync $winid
}

# ........................................................ Snap windows to level

snaphorizon() {
	desktop=$(xdotool get_desktop)
	winids=$(wmctrl -l | grep "^[^ ]*  *$desktop " | cut -d' ' -f1)  # of current desktop

	for i in $winids ;do
		# xdotool windowactivate --sync $i
		xdotool windowactivate $i  # faster
		xdotool key Super+Shift+g  # 2bwm vertical center
	done

	xdotool windowactivate --sync $winid
}

case $1 in
	''     ) snapnear    ;; # nearest left/right edge
	left   ) snapleft    ;;
	center ) xdotool key Super+g ;;
	right  ) snapright   ;;
	top    ) snaptop     ;;
	bottom ) snapbottom  ;;
	all    ) snaphorizon ;;
esac

# vim: set ft=sh: #
